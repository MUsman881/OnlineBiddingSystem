@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@model User
@{
    ViewData["Title"] = "Profile";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<div class="container-fluid pt-4 px-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="main-breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "User")">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="javascript:void(0)">User</a></li>
            <li class="breadcrumb-item active" aria-current="page">Profile Settings</li>
        </ol>
    </nav>
    <!-- /Breadcrumb -->
    <div class="row gutters-sm">
        <div class="col-md-4 d-none d-md-block">
            <div class="card">
                <div class="card-body">
                    <nav class="nav flex-column nav-pills nav-gap-y-1">
                        <a href="#profile" data-bs-toggle="tab" class="nav-item nav-link has-icon nav-link-faded active">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user me-2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>Profile Information
                        </a>
                        <a href="#security" data-bs-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield me-2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>Security
                        </a>
                        <a href="#account" data-bs-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings me-2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>Account Settings
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card">
                <div class="card-header border-bottom mb-3 d-flex d-md-none">
                    <ul class="nav nav-tabs card-header-tabs nav-gap-x-1" role="tablist">
                        <li class="nav-item">
                            <a href="#profile" data-bs-toggle="tab" class="nav-link has-icon active"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></a>
                        </li>
                        <li class="nav-item">
                            <a href="#security" data-bs-toggle="tab" class="nav-link has-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></a>
                        </li>

                        <li class="nav-item">
                            <a href="#account" data-bs-toggle="tab" class="nav-link has-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg></a>
                        </li>
                    </ul>
                </div>
                <div class="card-body tab-content">
                    <div class="tab-pane active" id="profile">
                        <h6 class="text-dark">YOUR PROFILE INFORMATION</h6>
                        <hr class="text-muted">
                        @using (Html.BeginForm("ChangeProfile", "User", FormMethod.Post, new { onsubmit = "return SubmitForm(this)" }))
                        {
                            <div class="form-group mb-2">
                                <label for="fullName">First Name</label>
                                <input type="text" class="form-control" id="firstName" asp-for="FirstName" name="FirstName" value="@Model.FirstName">
                                <small id="fullNameHelp" class="form-text text-muted">Your name may appear around here where you are mentioned. You can change or remove it at any time.</small>
                            </div>
                            <div class="form-group mb-2">
                                <label for="lastName">Last Name</label>
                                <input type="text" class="form-control" id="lastName" asp-for="LastName" name="LastName" value="@Model.LastName">
                                <small id="fullNameHelp" class="form-text text-muted">Your name may appear around here where you are mentioned. You can change or remove it at any time.</small>
                            </div>

                            <div class="form-group mb-2">
                                <label for="lastName">Email</label>
                                <input type="text" class="form-control" asp-for="Email" value="@Model.Email" readonly>
                            </div>

                            <div class="form-group mb-2">
                                <label for="country">Country</label>
                                <input type="text" class="form-control" asp-for="Country" id="country" name="Country">
                            </div>
                            <div class="form-group mb-2">
                                <label for="city">City</label>
                                <input type="text" class="form-control" id="city" asp-for="City" name="City">
                            </div>
                            <div class="form-group mb-2">
                                <label for="mobile">Mobile</label>
                                <input type="number" class="form-control" id="mobile" asp-for="Mobile" name="Mobile">
                            </div>
                            <div class="form-group small text-muted mt-3 mb-3">
                                All of the fields on this page are optional and can be deleted at any time, and by filling them out, you're giving us consent to share this data wherever your user profile appears.
                            </div>
                            <button type="submit" id="btnUpdate" class="btn btn-primary">Update Profile</button>
                        }
                    </div>
                    <div class="tab-pane" id="security">
                        <h6 class="text-dark">SECURITY SETTINGS</h6>
                        <hr class="text-muted">
                        @using (Html.BeginForm("ChangePassword", "User", FormMethod.Post, new { onsubmit = "return ChangePassword(this)" }))
                        {
                            <label class="d-block mb-3">Change Password</label>
                            <div class="form-inner">
                                <label>Password *</label>
                                <input type="password" class="form-control mt-2" name="Password" id="txtNewPassword" placeholder="Create A Password" required>
                                <i class="bi bi-eye-slash" id="togglePassword"></i>
                            </div>
                            <div class="form-inner">
                                <label>Confirm Password *</label>
                                <input type="password" class="form-control mt-2" id="txtConfirmPassword" name="ConfirmPassword" placeholder="Confirm new password">
                                <i class="bi bi-eye-slash" id="togglePassword"></i>
                            </div>
                            <div class="mt-2" id="CheckPasswordMatch"></div>

                            <button type="submit" id="changepassword" class="btn btn-primary mt-3">Change Password</button>
                        }
                    </div>
                    <div class="tab-pane" id="account">
                        <h6 class="text-dark">ACCOUNT SETTINGS</h6>
                        <hr class="text-muted">
                        <form>
                            <div class="form-inner">
                                <label class="d-block text-danger">Delete Account</label>
                                <p class="text-muted font-size-sm">Once you delete your account, there is no going back. Please be certain.</p>
                            </div>
                            <button onclick="deleteAccount(@Model.Id)" class="btn btn-danger" type="button">Delete Account</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

@section Scripts{
    <script>
        $(document).ready(function () {
            $("#txtConfirmPassword").keyup(checkPasswordMatch);
        });

        function checkPasswordMatch() {
            var password = $("#txtNewPassword").val();
            var confirmPassword = $("#txtConfirmPassword").val();
            if (password != confirmPassword)
                $("#CheckPasswordMatch").html("Password does not match!").css("color", "red");
            else
                $("#CheckPasswordMatch").html("Password match!").css("color", "green");
        }

        function SubmitForm(form) {

            $.ajax({
                type: "POST",
                url: form.action,
                data: $(form).serialize(),
                success: function (data) {
                    debugger;
                    if (data.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Success",
                            text: data.message
                        })
                    }
                    else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: data.message
                        })
                    }
                }
            })
            return false;
        }

        function ChangePassword(form) {

            $.ajax({
                type: "POST",
                url: form.action,
                data: $(form).serialize(),
                success: function (data) {
                    if (data.success) {
                        debugger;
                        Swal.fire({
                            icon: "success",
                            title: "Change Password",
                            text: data.message
                        })
                    }
                    else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: data.message
                        })
                    }
                }
            })
            return false;
        }

        function deleteAccount(userId) {
            debugger;
            Swal.fire({
                title: "Are you sure?",
                text: "You want to delete your account?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: 'POST',
                        url: "@Url.Action("DeleteUser", "User")",
                        data: { id: userId },
                        success: function (data) {
                            if (data.success) {
                                Swal.fire({
                                    icon: "success",
                                    title: "Success",
                                    text: data.message
                                });
                               window.setTimeout(function () {
                                window.location.href = '@Url.Action("Index", "Home")';
                            }, 1000);
                            }
                            else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: data.message
                                });
                            }
                        }
                    })
                }

            })

        }

    </script>
}

